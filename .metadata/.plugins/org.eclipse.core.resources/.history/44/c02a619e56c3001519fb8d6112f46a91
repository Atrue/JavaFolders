package application;

import javafx.scene.paint.Color;
import java.util.ArrayList;
import java.util.Random;

import javafx.scene.Scene;
import javafx.scene.canvas.Canvas;
import javafx.scene.canvas.GraphicsContext;

public class MyCanvas extends Canvas {  
	private static Random r = new Random();
    private ArrayList<MyLabel> f = new ArrayList<>(); // �����, � ������� �������� ����  
    private ArrayList<MyLabel> s = new ArrayList<>(); // ��������� ����� ����� ���������  
    private GraphicsContext gc; // ���������� ��� ���������  
    private double dx;
    public MyCanvas(Scene scene){  
        super(scene.getWidth(), scene.getHeight());  
        widthProperty().bind(scene.widthProperty()); //������ �������� ������ ������� � ������ �����  
        //������ �������� ������ ������� � ������ �����  
        gc = getGraphicsContext2D();  
    }  
     
   public void addPair(MyLabel n1, MyLabel n2){  
        f.add(n1);  
        s.add(n2);  
        repaintContext();
    }  
     
   public void repaintContext(){  
	   double width = getWidth();  
	   double height = getHeight();  
	   gc.clearRect(0, 0, width, height); // ������� ������� 
	   for(int i = 0; i < f.size(); i++){   
	      MyLabel n1 = f.get(i);  
	      MyLabel n2 = s.get(i);  
	      //n2.move();
	      //������ �����  
	      strokeLine(n1.getCenterX(), n1.getCenterY(), n2.getCenterX(), n2.getCenterY());  
	   } 
   }
   private void strokeLine(double x1, double y1, double x2, double y2){  
	  
	   double stSin = 10;
	   
	   double minX = x2 > x1 ? x1: x2;
	   double maxX = x2 > x1 ? x2: x1;
	   double minY = y2 > y1 ? y1: y2;
	   double maxY = y2 > y1 ? y2: y1;
	   
	   double[] xSs = new double[200];
	   double[] ySs = new double[200];
	   
	   for(int x=0; x<100; x++){
		   double rad = x*18 * Math.PI / 180;
		   double dotY = Math.sin(rad) * stSin + minY + (maxY - minY)*x/100;
		   double dotX = minX + (maxX - minX)*x/100;
		   xSs[x] = dotX -10;
		   xSs[xSs.length-1 - x] = dotX + 10;
		   ySs[x] = dotY;
		   ySs[ySs.length-1 - x] = dotY;
	   }
	   gc.setFill(Color.color((int)(r.nextDouble()*255), (int)(r.nextDouble()*255), (int)(r.nextDouble()*255)));
	   gc.fillPolygon(xSs, ySs, 200);
	   
	   /*
	   double xR = Math.max(2 *Math.PI * Math.abs(x2 - x1) / 200, Math.PI * 2);  
	   double n = 200; // ���������� ������ ���������  
	     
	     
	   if (x1 > x2){   // ������ �������, ����� �� ������������ ����������� abs(double, double)  
	      double b = x1;   x1 = x2; x2 = b;  
	            b = y1;  y1 = y2; y2 = b;  
	   }  
	   double l = (x2 - x1); //������ �������� �� ��� �  
	   double dWidth = (x2 - x1) / n; // ���������� �  
	     
	   double bx = x1; // �������� ����������  
	   double by = y1; // �������� ���������� ��������   
	     
	   for(double x = x1; x < x2; x+=dWidth){  
	      double xSin = (x - x1) / l * xR; // ������� ������������ �������� � � [0..xR]  
	      double ySin = 50*Math.sin(xSin - dx) * // sin с отклонением 
	                 (x2 - x > 200 ? 1 : (x2 - x) / 200)  + (x - x1) / l * Math.abs(y1 - y2) + Math.min(y1, y2); // wtf?  
	      
	      
	      gc.strokeLine(bx, by, x, ySin); // ������ ����� �� ��������� �������  
	        
	      bx = x;   // ��������� ������� ��������, ����� �� ������� 2 ����.  
	      by = ySin;  
	      dx += 0.02;  
	   }  
	   */
	}  
}  